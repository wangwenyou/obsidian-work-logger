/* === Variables (Merged & Optimized) === */
:root {
    /* Reference Palette */
    --wl-accent-color: #4A90E2;
    --wl-accent-color-rgb: 74, 144, 226;
    --wl-text-on-accent: #ffffff;
    --wl-background-primary: #ffffff; /* Default Obsidian light is usually white */
    --wl-background-secondary: #f8f9fa;
    --wl-background-tertiary: #e9ecef;
    --wl-border-color: #ced4da;
    --wl-text-normal: #343a40;
    --wl-text-muted: #6c757d;
    --wl-text-faint: #adb5bd;
    --wl-radius: 12px;
    --wl-radius-small: 8px;
    --wl-spacing: 24px;
    --wl-transition: 200ms cubic-bezier(0.4, 0, 0.2, 1);
    
    /* Category Colors */
    --wl-accent-secondary: #FF6B6B;
    --wl-accent-cyan: #00A896;
    --wl-red: #FF6B6B;
    --wl-green: #00A896;
    --wl-blue: #4A90E2;
    --wl-purple: #A855F7;
    --wl-yellow: #FFD93D;
    
    /* Legacy/Dashboard specific (Preserved) */
    --wl-navy: #192A56;
    --wl-primary-color: #4a90e2;
    --wl-secondary-color: #50e3c2;
    --wl-cyan-legacy: #06D6A0;
}

.theme-dark {
    /* Reference Palette Dark */
    --wl-accent-color: #4A90E2;
    --wl-accent-color-rgb: 74, 144, 226;
    --wl-background-primary: #202020;
    --wl-background-secondary: #2C2E33;
    --wl-background-tertiary: #343A40;
    --wl-border-color: #333;
    --wl-text-normal: #dcddde;
    --wl-text-muted: #999;
    --wl-text-faint: #6C757D;
    --wl-accent-secondary: #FF6B6B;
    
    /* Legacy/Dashboard specific */
    --wl-navy: #A5B4FC; 
}

/* === Main Container === */
.work-logger-container {
    padding: 16px;
    font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    display: flex;
    flex-direction: column;
    gap: 16px;
    height: 100%;
}

/* === Sidebar Calendar (Restored from Reference) === */
.calendar-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 8px;
}

.calendar-header h3 {
    margin: 0;
    font-size: 1.1rem;
    font-weight: 700;
    color: var(--wl-text-normal);
}

.calendar-header button {
    background: transparent;
    border: none;
    color: var(--wl-text-faint);
    border-radius: 8px;
    padding: 8px;
    cursor: pointer;
    transition: var(--wl-transition);
    display: flex;
    align-items: center;
    justify-content: center;
}

.calendar-header button:hover {
    background: var(--wl-background-secondary);
    color: var(--wl-accent-color);
}

.calendar-grid {
    display: grid;
    grid-template-columns: 40px repeat(7, 1fr); /* 8 columns: 1 for button, 7 for days */
    gap: 4px;
    text-align: center;
    align-items: center;
    margin-bottom: 16px;
}

.day-header {
    font-size: 0.7rem;
    color: var(--wl-text-muted);
    padding-bottom: 8px;
    font-weight: 600;
}

.day-cell {
    position: relative;
    cursor: pointer;
    padding: 6px 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 3px;
    border-radius: var(--wl-radius-small);
    transition: background-color 0.2s;
}

.day-cell:hover {
    background-color: var(--wl-background-secondary);
}

.day-number {
    width: 28px;
    height: 28px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.85rem;
    border-radius: 50%;
    color: var(--wl-text-normal);
    font-weight: 500;
    transition: var(--wl-transition);
}

.day-cell.today .day-number {
    background-color: var(--wl-accent-color);
    color: white;
    font-weight: 700;
}

.day-cell.other-month { opacity: 0.3; }

/* The missing indicator! */
.event-mark {
    width: 4px;
    height: 4px;
    border-radius: 50%;
    background-color: var(--wl-accent-secondary);
}

.week-stat-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    color: var(--wl-text-faint);
    border-radius: 8px;
    transition: var(--wl-transition);
    height: 32px;
}

.week-stat-btn:hover {
    background-color: var(--wl-accent-color);
    color: white;
}

/* === Task List (Sidebar) === */
.tasks-container {
    border-top: 1px solid var(--wl-border-color);
    padding-top: 16px;
}

.tasks-header {
    font-size: 0.95rem;
    font-weight: 700;
    color: var(--wl-text-normal);
    margin-bottom: 12px;
    display: flex;
    align-items: center;
    gap: 8px;
}

.task-list {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.task-card {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 8px 10px;
    background: var(--wl-background-primary);
    border: 1px solid var(--wl-border-color);
    border-radius: 8px;
    cursor: pointer;
    transition: border-color 0.2s;
}

.task-card:hover {
    border-color: var(--wl-accent-color);
}

.checkbox {
    width: 14px;
    height: 14px;
    border: 2px solid var(--wl-text-muted);
    border-radius: 4px;
    flex-shrink: 0;
}

.task-content {
    flex: 1;
    min-width: 0;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 8px;
}

.task-text {
    font-size: 0.85rem;
    color: var(--wl-text-normal);
    font-weight: 500;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.task-meta {
    font-size: 0.7rem;
    color: var(--wl-text-faint);
    flex-shrink: 0;
}

.tasks-empty {
    padding: 8px;
    color: var(--wl-text-faint);
    font-size: 0.85rem;
    font-style: italic;
}

/* === Timeline (Sidebar) === */
.timeline-container {
    border-top: 1px solid var(--wl-border-color);
    padding-top: 16px;
    cursor: pointer;
}

.timeline-container:hover .timeline-header { color: var(--wl-accent-color); }

.timeline-header {
    font-size: 0.95rem;
    font-weight: 700;
    color: var(--wl-text-normal);
    margin-bottom: 12px;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: color 0.2s;
}

.timeline-content {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.timeline-empty {
    padding: 16px;
    color: var(--wl-text-faint);
    font-size: 0.85rem;
    text-align: center;
    background: var(--wl-background-secondary);
    border-radius: 8px;
}

.timeline-day {
    margin-bottom: 8px;
}

.timeline-day-header {
    font-size: 0.8rem;
    font-weight: 600;
    color: var(--wl-text-muted);
    margin-bottom: 6px;
    padding: 4px 8px;
    background: var(--wl-background-secondary);
    border-radius: 6px;
}

.timeline-day-list {
    display: flex;
    flex-direction: column;
    gap: 4px;
    padding-left: 8px;
}

.timeline-item {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 6px 8px;
    background: var(--wl-background-primary);
    border-radius: 6px;
    border: 1px solid transparent; /* Align with reference */
}

.timeline-icon {
    flex-shrink: 0;
    display: flex;
    align-items: center;
}

.timeline-icon svg {
    width: 14px;
    height: 14px;
    stroke: var(--wl-accent-color);
}

.timeline-time {
    font-size: 0.75rem;
    font-weight: 600;
    color: var(--wl-accent-color);
    min-width: 36px;
    flex-shrink: 0;
}

.timeline-content-text {
    font-size: 0.8rem;
    color: var(--wl-text-normal);
    flex: 1;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.timeline-duration {
    font-size: 0.7rem;
    color: var(--wl-text-faint);
    flex-shrink: 0;
}

.timeline-item.current {
    border-color: var(--wl-accent-color);
    background: rgba(74, 144, 226, 0.05);
}

/* Category Colors */
.timeline-category-meeting .timeline-icon svg { stroke: var(--wl-red); }
.timeline-category-coding .timeline-icon svg { stroke: var(--wl-green); }
.timeline-category-design .timeline-icon svg { stroke: var(--wl-blue); }
.timeline-category-reading .timeline-icon svg { stroke: var(--wl-purple); }

/* === Modal (Common) === */
.modal-content.work-logger-dashboard-modal,
.modal-content.month-timeline-modal {
    padding: 0;
    overflow: hidden;
    /* Use explicit !important to override default modal sizing constraints */
    max-width: 98vw !important;
    width: 98vw !important;
    height: 95vh !important;
    border-radius: 16px;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
    display: flex;
    flex-direction: column;
    background-color: var(--wl-background-primary);
}

.theme-dark .modal-content.work-logger-dashboard-modal,
.theme-dark .modal-content.month-timeline-modal {
    background-color: #1A1B1E;
}

/* === Dashboard (Report Modal) Styles === */
.dashboard-main {
    flex: 1; display: flex; flex-direction: column; height: 100%;
    background: #FAFAFA; /* Light grey background for the whole dashboard area */
}

/* Header */
.dashboard-header {
    padding: 20px 40px; 
    background: var(--wl-background-primary); 
    border-bottom: 1px solid rgba(0,0,0,0.03);
    display: flex; justify-content: space-between; align-items: center;
}

.header-left-group { display: flex; align-items: center; justify-content: space-between; flex-grow: 1; }
.header-title-group { display: flex; align-items: baseline; gap: 12px; white-space: nowrap; }
.header-title-text { font-size: 1.5rem; font-weight: 800; color: var(--wl-navy); letter-spacing: -0.5px; }
.header-range-text { font-size: 1.1rem; font-weight: 700; color: var(--wl-accent-secondary); font-family: monospace; }
/* RESTORED: Custom range button in header */
.custom-range-btn {
    background: transparent;
    border: 1px solid var(--wl-border-color);
    border-radius: 8px;
    width: 32px;
    height: 32px;
    cursor: pointer;
    color: var(--wl-text-muted);
    display: flex !important; /* Force display */
    align-items: center;
    justify-content: center;
    transition: all 0.2s;
    flex-shrink: 0; /* Prevent button from shrinking */
}
.custom-range-btn:hover { background: var(--wl-background-secondary); color: var(--wl-navy); }

.dashboard-scroll-area { 
    flex: 1; overflow-y: auto; padding: 40px; 
    display: flex; flex-direction: column; gap: 32px;
}

/* 1. Stat Cards Row */
.stats-grid { display: flex; gap: 32px; flex-wrap: wrap; align-items: stretch; }

/* Common Card Style */
.stat-card {
    background: white; 
    border-radius: 24px; 
    padding: 32px; 
    box-shadow: 0 12px 30px rgba(0, 0, 0, 0.03); 
    border: 1px solid rgba(0,0,0,0.02);
    display: flex; flex-direction: column;
}

.theme-dark .stat-card { background: #2C2E33; }

/* Total Hours Card (Left) */
.total-hours-card { 
    flex: 0 0 300px; /* Fixed width */
    align-items: center; 
    justify-content: center; 
    text-align: center;
}

.total-hours-card .card-label { 
    font-size: 0.8rem; 
    font-weight: 800; 
    color: #94A3B8; /* Slate 400 */
    text-transform: uppercase; 
    letter-spacing: 0.15em;
    margin-bottom: 8px;
}

.total-hours-card .card-value { 
    font-size: 5.5rem; 
    font-weight: 900; 
    color: var(--wl-navy); 
    line-height: 1;
    margin: 16px 0;
    font-family: "Inter", -apple-system, sans-serif;
}

.theme-dark .total-hours-card .card-value { color: #E2E8F0; }

.total-hours-card .card-sub { 
    color: #94A3B8; 
    font-size: 0.9rem; 
    font-style: italic;
    font-family: "Georgia", serif; 
}

/* Distribution Card (Right) */
.distribution-card {
    flex: 1;
    min-width: 400px;
    padding: 32px 40px;
}

.dist-header {
    display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;
}
.dist-title { font-size: 1.1rem; font-weight: 700; color: var(--wl-text-normal); }

.icon-copy-btn { 
    background: transparent; border: 1px solid var(--wl-border-color); border-radius: 8px; 
    width: 32px; height: 32px; cursor: pointer; color: var(--wl-text-muted); 
    display: flex; align-items: center; justify-content: center;
    transition: all 0.2s;
}
.icon-copy-btn:hover { background: var(--wl-background-secondary); color: var(--wl-navy); }

.progress-bar-group { display: flex; flex-direction: column; gap: 20px; }
.progress-item { display: flex; flex-direction: column; gap: 8px; }

.progress-item .item-info { display: flex; justify-content: space-between; align-items: flex-end; }
.progress-item .item-name { 
    font-size: 0.95rem; font-weight: 700; color: var(--wl-text-normal); 
}
.progress-item .item-hours { 
    font-size: 0.9rem; font-weight: 700; color: var(--wl-text-muted); font-family: monospace; 
}

.bar-bg { height: 10px; background: #F1F5F9; border-radius: 5px; overflow: hidden; width: 100%; }
.theme-dark .bar-bg { background: rgba(255,255,255,0.1); }

.bar-fill { height: 100%; border-radius: 5px; transition: width 0.8s cubic-bezier(0.2, 0.8, 0.2, 1); }

/* Bar Colors */
.bg-indigo { background-color: #192A56; }
.bg-emerald { background-color: #FF6B6B; } /* Using Accent Secondary (Red/Coral) */
.bg-blue { background-color: #4A90E2; }
.bg-amber { background-color: #FFD166; }
.bg-purple { background-color: #A855F7; }

/* 2. AI Section */
.ai-section { 
    background: white; 
    border-radius: 24px; 
    padding: 32px; 
    border: none;
    box-shadow: 0 12px 30px rgba(0, 0, 0, 0.03); 
    display: flex; flex-direction: column; gap: 20px;
}
.theme-dark .ai-section { background: #2C2E33; }

/* AI Controls (Mode Switcher) */
.ai-controls-row { display: flex; gap: 8px; margin-bottom: 0; }
.mode-switcher-icons { display: flex; gap: 8px; }

.mode-icon-btn { 
    width: 40px; height: 40px; border-radius: 10px; border: 1px solid var(--wl-border-color); 
    cursor: pointer; color: var(--wl-text-muted); background: white;
    display: flex; align-items: center; justify-content: center;
    transition: all 0.2s;
}
.mode-icon-btn:hover { border-color: var(--wl-navy); color: var(--wl-navy); transform: translateY(-1px); }
.mode-icon-btn.active { background: var(--wl-navy); color: white; border-color: var(--wl-navy); box-shadow: 0 4px 10px rgba(25, 42, 86, 0.2); }
.theme-dark .mode-icon-btn { background: #343A40; border-color: #495057; }

/* AI Input Area */
.ai-input-row { display: flex; gap: 24px; height: 160px; }

.textarea-wrapper { flex: 1; position: relative; height: 100%; }
.zap-icon { position: absolute; top: 16px; left: 16px; color: var(--wl-yellow); z-index: 2; pointer-events: none; }

.ai-prompt-input { 
    width: 100%; height: 100% !important; 
    background: #F8FAFC; /* Very light blue-grey */
    border: none;
    border-radius: 16px; padding: 16px 16px 16px 44px; /* Left padding for icon */
    resize: none; 
    font-family: "Inter", sans-serif;
    font-size: 0.95rem;
    line-height: 1.6;
    color: var(--wl-text-normal);
    transition: all 0.2s;
}
.ai-prompt-input:focus { 
    background: white; 
    box-shadow: 0 0 0 2px var(--wl-navy), 0 8px 20px rgba(0,0,0,0.05); 
}
.theme-dark .ai-prompt-input { background: #1A1B1E; }

.start-gen-btn { 
    width: 160px; height: 100%;
    background: white; 
    color: var(--wl-text-normal); 
    border: 1px solid var(--wl-border-color);
    border-radius: 16px; 
    cursor: pointer; 
    font-weight: 700;
    display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 8px;
    transition: all 0.2s;
    box-shadow: 0 4px 10px rgba(0,0,0,0.02);
}
.start-gen-btn .btn-icon svg { width: 24px; height: 24px; }
.start-gen-btn:hover { 
    border-color: var(--wl-navy); color: var(--wl-navy);
    transform: translateY(-2px); box-shadow: 0 8px 20px rgba(0,0,0,0.05);
}

/* AI Results */
.ai-result-area { margin-top: 0; }
.ai-loading-box { padding: 40px; }
.spinner { color: var(--wl-navy); width: 24px; height: 24px; }

.ai-result-card { 
    background: #F8FAFC; 
    border: 1px solid #E2E8F0; 
    border-radius: 16px; 
    padding: 32px; 
}
.theme-dark .ai-result-card { background: rgba(255,255,255,0.03); border-color: rgba(255,255,255,0.1); }

.result-header { margin-bottom: 24px; border-bottom: 1px solid rgba(0,0,0,0.05); padding-bottom: 16px; }
.result-label { font-size: 0.8rem; font-weight: 800; color: var(--wl-navy); letter-spacing: 1px; text-transform: uppercase; }

/* Folding for Markdown */
.wl-collapsible-header { cursor: pointer; display: flex; align-items: center; user-select: none; }
.wl-collapse-indicator { width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; margin-right: 4px; color: var(--wl-text-muted); transition: transform 0.2s; }
.wl-collapsible-header:hover .wl-collapse-indicator { color: var(--wl-navy); }
.wl-hidden { display: none !important; }

/* === Month Timeline Modal (Card Style from Reference) === */
.month-timeline-modal .month-timeline-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px 32px;
    background-color: var(--wl-background-secondary);
    border-bottom: 1px solid var(--wl-border-color);
}

.month-timeline-header h2 {
    margin: 0;
    font-size: 1.5rem;
    font-weight: 800;
    color: var(--wl-navy);
}

.month-nav-btn {
    background: white;
    border: 1px solid var(--wl-border-color);
    border-radius: 8px;
    padding: 8px;
    cursor: pointer;
    box-shadow: 0 2px 5px rgba(0,0,0,0.05);
}

.month-timeline-weeks {
    flex: 1;
    overflow-y: auto;
    padding: 24px;
    background-color: var(--wl-background-secondary);
    /* Fix: Ensure it takes full width */
    width: 100%;
}

.theme-dark .month-timeline-weeks { background-color: #25262b; }

.month-timeline-table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 12px;
    table-layout: fixed;
}

.month-week-header-cell {
    background-color: var(--wl-navy);
    color: white;
    padding: 10px;
    border-radius: 8px;
    text-align: center;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
}

.month-weekday-side-cell {
    text-align: center;
    font-weight: 800;
    color: var(--wl-navy);
    font-size: 0.85rem;
    width: 40px !important; /* Force match colgroup */
    white-space: nowrap;
    padding: 0 4px !important;
}

.month-weekday-corner-cell {
    width: 40px !important;
    padding: 0 !important;
    background: transparent !important;
    box-shadow: none !important;
}

.month-day-cell {
    background-color: var(--wl-background-primary);
    border-radius: 12px;
    padding: 40px 8px 45px 8px; /* Extra bottom padding for EOD item */
    min-height: 120px;
    vertical-align: top;
    position: relative;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
    transition: transform 0.2s ease, box-shadow 0.2s ease;
    border: 1px solid rgba(0,0,0,0.05);
    overflow: hidden; /* Ensure absolute children don't overflow border-radius */
}

.month-day-cell .timeline-item.timeline-item-end {
    position: absolute !important;
    bottom: 8px !important;
    right: 12px !important;
    width: auto !important; /* Let content decide width */
    background-color: transparent !important;
    margin: 0 !important;
    padding: 0 !important;
    border-radius: 0 !important;
    display: flex !important;
    align-items: center !important;
    gap: 6px !important;
    border: none !important;
    box-sizing: border-box !important;
}

.theme-dark .month-day-cell .timeline-item.timeline-item-end {
    background-color: transparent !important;
}



.timeline-item.timeline-item-end .timeline-time {
    color: #94A3B8;
    font-weight: 600;
    font-size: 0.75rem;
}

.timeline-item.timeline-item-end .timeline-icon svg {
    width: 14px;
    height: 14px;
    stroke: #94A3B8;
    stroke-width: 2px;
}

.month-day-cell.clickable { cursor: pointer; }

.month-day-cell.empty-cell {
    background-color: transparent;
    box-shadow: none;
    border: 1px dashed var(--wl-border-color);
}

.month-day-cell .date-label {
    position: absolute;
    top: 8px;
    left: 10px;
    font-size: 1.1rem;
    font-weight: 800;
    color: var(--wl-navy);
    opacity: 0.8;
}

.month-day-cell .date-label.today { color: var(--wl-accent-secondary); opacity: 1; }

.month-day-cell .date-label::after {
    content: '';
    display: block;
    width: 16px;
    height: 3px;
    background: var(--wl-accent-secondary);
    margin-top: 2px;
    border-radius: 2px;
    opacity: 0.5;
}

/* === Global Modal Fixes (Force Full Width) === */
/* This is crucial to override Obsidian's default modal styles */
.modal-container:has(.work-logger-dashboard-modal),
.modal-container:has(.month-timeline-modal) {
    padding: 0 !important;
}

.modal-container .modal.work-logger-dashboard-modal,
.modal-container .modal.month-timeline-modal {
    max-width: 98vw !important;
    width: 98vw !important;
    height: 95vh !important;
    max-height: 95vh !important;
    padding: 0 !important;
    margin: 0 !important;
    border-radius: 20px;
    background-color: var(--wl-background-primary);
}

/* Ensure content takes full space */
.modal-content.work-logger-dashboard-modal,
.modal-content.month-timeline-modal {
    width: 100% !important;
    height: 100% !important;
    max-width: none !important;
    padding: 0 !important;
    display: flex;
    flex-direction: column;
}